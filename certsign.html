<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>certsign</title>
		<script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function(){
				$( "#submit" ).click(function() {
				    submitcsr();
				});
			
				function submitcsr(){
					data = {
						  hostname: $("#hostname").val(),
				  	  	  certificate_request: $("#csr").val(),
						  profile: "www"
					}
					$.ajax({
					  url: window.location.protocol + '//' + window.location.hostname + ':8080/cfssl-api/api/v1/cfssl/sign',
					  type: 'POST',
	  				  dataType: 'json',
	  				  data: JSON.stringify(data),
	  				  success: function(data, textStatus, xhr) {
						  $(".error").each(function(i, e){
							  $(e).text("");
						  });
						  $("#message").text("Copy the certificate below into a text editor and save it as your certificate");
						  $("#certificate").text(data.result.certificate);
					  },
	  				  error: function(xhr, textStatus, errorThrown) {
						  $("#error").text(errorThrown);
						  var json = $.parseJSON(xhr.responseText);
						  $(json.errors).each(function(i,val){
							  p = document.createElement("p");
							  $(p).text(val.message);
							  $("#error_sub1").append(p);    
						  });
					  }
					});
				}				
			});
		</script>
		<style type="text/css" media="screen">
			textarea {
			  border:1px solid #999999;
			  font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;
			  font-size: 12pt;
			}
			input {
			  border:1px solid #999999;
			  font-size: 12pt;
			}
			.label {
			  font-size: 12pt;
			}
			.error {
				color:red;
			}
			#message {
				color:green;
			}
		</style>
	</head>
	<body id="certsign" onload="">
		<h1>IT 351 Certificate Authority</h1>
		<h2>Submit your Certificate Signing Request Below</h2>
		<h2 class="error" id="error"></h2>
		<p class="error" id="error_sub1"></p>
		<p class="error" id="error_sub2"></p>
		<p>
			<label class="label" for="hostname">Hostname/ip (separate multiple entries with commas):</label>
			<input type="text" cols="25" name="hostname" value="" id="hostname">
			<br/>
			<br/>
			<textarea rows="30" cols="65" name="csr" value="" id="csr"></textarea>
			<br/>
			<button id="submit">Submit</button>
		</p>
		<p id="message">
		</p>
		<pre id="certificate">
		</pre>
	</body>
</html>
